-------已滿足第二及第三正規化
-------每一個非鍵屬性皆完全相依於主鍵(第二正規化)
CREATE TABLE APPLICANT (
  APP_NUM INT ,
  APP_CODE INT,
  APP_FNAME varchar(15),
  APP_LNAME varchar(15),
  APP_EMAIL VARCHAR(25),
  APP_PHONE VARCHAR(25),
  APP_EDUCATION VARCHAR(25),
  APP_AGE INT
  PRIMARY KEY(APP_NUM)
);

----已滿足第二及第三正規化
CREATE TABLE INTERVIEW(
  INT_CODE VARCHAR(10),
  INT_START_TIME DATETIME,
  INT_END_TIME DATETIME,
  PRIMARY KEY(INT_CODE)
);
----已滿足第二及第三正規化
CREATE TABLE COMPANY (
  COM_CODE      NUMERIC(5,0)  NOT NULL,
  COM_NAME     VARCHAR(50) NOT NULL,
  PRIMARY KEY(COM_CODE)
);

----進行第三正規化

CREATE TABLE POSITION (
  POI_CODE NUMERIC(6,0) NOT NULL,
  POI_DATE DATE NOT NULL,
  PRIMARY KEY(POI_CODE)
);
---------放跟公司有關的獨立進來
CREATE TABLE POSITION_DETAILS (
  POI_CODE NUMERIC(6,0) NOT NULL,
  INT_CODE VARCHAR(10) NOT NULL,
  COM_CODE NUMERIC(5,0) NOT NULL,
  PRIMARY KEY(POI_CODE),
  FOREIGN KEY(POI_CODE) REFERENCES POSITION(POI_CODE) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY(INT_CODE) REFERENCES INTERVIEW(INT_CODE) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY(COM_CODE) REFERENCES COMPANY(COM_CODE) ON UPDATE CASCADE ON DELETE CASCADE
);

---------面試者與職位編號
CREATE TABLE APPLICANT_POSITION (
  POI_CODE NUMERIC(6,0) NOT NULL,
  APP_NUM INT NOT NULL,
  PRIMARY KEY(POI_CODE, APP_NUM),
  FOREIGN KEY(POI_CODE) REFERENCES POSITION(POI_CODE) ON UPDATE CASCADE ON DELETE CASCADE,
  FOREIGN KEY(APP_NUM) REFERENCES APPLICANT(APP_NUM) ON UPDATE CASCADE ON DELETE CASCADE
);


----需要第二但不需要第三正規化

----進行第二正規化

---面試編號與面試主管
CREATE TABLE SUPERVISTOR_CODE (
  SUP_CODE varchar(5) PRIMARY KEY,
  SUP_NUM varchar(10) UNIQUE,
  INT_CODE VARCHAR(10),
  FOREIGN KEY(INT_CODE) REFERENCES INTERVIEW(INT_CODE) ON UPDATE CASCADE ON DELETE CASCADE
);
--------主管個人
CREATE TABLE SUPERVISTOR1 (
  SUP_NUM varchar(10),
  SUP_FNAME varchar(15),
  SUP_LNAME varchar(15),
  SUP_EMAIL VARCHAR(25),
  PRIMARY KEY(SUP_NUM),
  FOREIGN KEY(SUP_NUM) REFERENCES SUPERVISTOR_CODE(SUP_NUM) ON UPDATE CASCADE ON DELETE CASCADE
);


INSERT INTO COMPANY VALUES (100, 'Master');

INSERT INTO INTERVIEW VALUES (1, '2018-02-05 09:00:00', '2018-02-05 12:00:00');
INSERT INTO INTERVIEW VALUES (2, '2018-02-06 13:30:00', '2018-02-06 17:00:00');
INSERT INTO INTERVIEW VALUES (3, '2018-02-07 10:00:00', '2018-02-07 13:00:00');

INSERT INTO SUPERVISTOR_CODE VALUES (222,1020,1);
INSERT INTO SUPERVISTOR_CODE VALUES (235, 1056,2);
INSERT INTO SUPERVISTOR_CODE VALUES (227,1185,3);

INSERT INTO SUPERVISTOR1 VALUES (1020,'Bonnie','Su','ko@gmail.com');
INSERT INTO SUPERVISTOR1 VALUES (1056,'Mika','Zhang','gi@gmail.com');
INSERT INTO SUPERVISTOR1 VALUES (1185,'Sunny','Su' ,'kk@gmail.com' );

INSERT INTO APPLICANT VALUES (1001,1,'Jenny','Su','ap@gmail.com','0945878489' ,'Senior high school ',20);
INSERT INTO APPLICANT VALUES (1002,2, 'Candy','Zhang','ak@gmail.com' ,'0905365745', ' University ',28);
INSERT INTO APPLICANT VALUES (1003,3,'Sandy','Su' ,'jp@gmail.com' ,'0985635214',' Master',19);
INSERT INTO APPLICANT VALUES (1004,4,'Judy','Chen' ,'ju@gmail.com' ,'0980889688',' Master',19);
INSERT INTO APPLICANT VALUES (1005,5,'Cindy','Lin' ,'ci@gmail.com' ,'0985625214',' University',18);

INSERT INTO POSITION VALUES (4, '2018-08-01');
INSERT INTO POSITION VALUES (5, '2018-08-02');
INSERT INTO POSITION VALUES (6, '2018-08-03');
INSERT INTO POSITION VALUES (7, '2018-08-01');
INSERT INTO POSITION VALUES (8, '2018-08-02');
INSERT INTO POSITION VALUES (9, '2018-08-10');
INSERT INTO POSITION VALUES (10, '2018-08-11');

INSERT INTO POSITION_DETAILS VALUES (4, 1,100);
INSERT INTO POSITION_DETAILS VALUES (5, 2,100);
INSERT INTO POSITION_DETAILS VALUES (6, 3,100);
INSERT INTO POSITION_DETAILS VALUES (7, 1,100);
INSERT INTO POSITION_DETAILS VALUES (8, 2,100);
INSERT INTO POSITION_DETAILS VALUES (9, 1,100);
INSERT INTO POSITION_DETAILS VALUES (10, 2,100);

INSERT INTO APPLICANT_POSITION VALUES (4,1001);
INSERT INTO APPLICANT_POSITION VALUES (5,1002);
INSERT INTO APPLICANT_POSITION VALUES (6,1003);
INSERT INTO APPLICANT_POSITION VALUES (7,1001);
INSERT INTO APPLICANT_POSITION VALUES (8,1002);
INSERT INTO APPLICANT_POSITION VALUES (9,1004);
INSERT INTO APPLICANT_POSITION VALUES (10,1005);

----JOIN語法

SELECT APPLICANT.APP_NUM, POSITION.POI_CODE
FROM APPLICANT
LEFT JOIN APPLICANT_POSITION ON APPLICANT.APP_NUM = APPLICANT_POSITION.APP_NUM
LEFT JOIN POSITION ON APPLICANT_POSITION.POI_CODE = POSITION.POI_CODE;
---面試者應試該面試的職位編號

SELECT INTERVIEW.INT_CODE, SUPERVISTOR1.SUP_NUM, SUPERVISTOR1.SUP_FNAME, SUPERVISTOR1.SUP_LNAME
FROM SUPERVISTOR1
LEFT JOIN SUPERVISTOR_CODE ON SUPERVISTOR1.SUP_NUM = SUPERVISTOR_CODE.SUP_NUM
LEFT JOIN INTERVIEW ON SUPERVISTOR_CODE.INT_CODE = INTERVIEW.INT_CODE
LEFT JOIN APPLICANT_POSITION ON INTERVIEW.INT_CODE = APPLICANT_POSITION.POI_CODE
----面試編號對應的面試官

----Subquery語法
SELECT APP_NUM,APP_FNAME, APP_LNAME
FROM APPLICANT
WHERE APP_NUM IN (
  SELECT APP_NUM
  FROM APPLICANT_POSITION
);

SELECT APP_NUM,APP_FNAME, APP_LNAME
FROM APPLICANT;
----
SELECT POI_CODE, POI_DATE
FROM POSITION
WHERE POI_CODE IN (
  SELECT PD.POI_CODE
  FROM POSITION_DETAILS PD
  WHERE PD.INT_CODE = 2
);
-----把面試編號是2的特別篩選出來
SELECT APP_NUM, APP_FNAME, APP_LNAME
FROM APPLICANT
WHERE APP_NUM IN (
SELECT APP_NUM
FROM APPLICANT_POSITION
WHERE APP_NUM = 1002
);
---搜尋特定應徵者
SELECT APP_NUM, APP_FNAME, APP_LNAME
FROM APPLICANT
WHERE APP_NUM IN (
SELECT APP_NUM
FROM APPLICANT_POSITION
WHERE APP_NUM IN (1002, 1004)
);

SELECT APP_LNAME,APP_FNAME ,SUP_FNAME,SUP_LNAME
FROM APPLICANT
CROSS JOIN SUPERVISTOR1;
-----面試官跟面試者面試排列組合交叉連接)

SELECT DISTINCT A.APP_FNAME, A.APP_LNAME, I.INT_START_TIME, I.INT_END_TIME, P.POI_DATE, S.SUP_FNAME, S.SUP_LNAME
FROM APPLICANT A
JOIN APPLICANT_POSITION AP ON A.APP_NUM = AP.APP_NUM
JOIN POSITION_DETAILS PD ON AP.POI_CODE = PD.POI_CODE
JOIN INTERVIEW I ON PD.INT_CODE = I.INT_CODE
JOIN SUPERVISTOR_CODE SC ON I.INT_CODE = SC.INT_CODE
JOIN SUPERVISTOR1 S ON SC.SUP_NUM = S.SUP_NUM
JOIN POSITION P ON PD.POI_CODE = P.POI_CODE;


